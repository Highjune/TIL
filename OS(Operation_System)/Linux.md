## 개념
- 셸(shell)
  - 사용자가 콘솔 환경에서 대화식으로 명령어를 입력하면서 사용하는 소프트웨어
  - 리눅스에서 bash나 dash라는 셸을 사용하는 경우 많음
  - vim으로 텍스트 편집하거나 grep으로 파일을 찾을 때, 이런 다양한 소프트웨어를 사용자 요구에 따라 실행하거나 조작을 돕는 게 셸의 역할
  - GNOME 단말은 셸인가?
    - No. GNOME 단말은 GUI 환경에서 셸을 실행하기 위해 사용하는 것으로 셸 자체가 아니다. tmux, ssh 도 마찬가지. 셸이라는 소프트웨어에 입력(vim 등)을 부탁하는 것
    - 



## 리눅스 명령어

- 명령어 내역 확인
```
history
```
```
vim ~/.bash_history
```

- 명령어 후방 검색
```
ctrl + r 후에 찾고자 하는 것 입력 ex) vim  후에 ctrl + r 계속 누르면서 찾기.(위로 올라감)
```
- 명령어 전방 검색
  - 설정 변경이 필요함
  ```
  vim ~/.bashrc 로 설정 파일 열기
  shift + g 로 파일 마지막으로 이동
  stty stop undef 입력
  ```
  - 콘솔 환경에 재로그인. bash를 재실행해서 새로운 설정을 읽어 들이는 것
  - `ctrl + s` 후에 찾고자 하는 것 입력 ex) vim  후에 `ctrl + s` 계속 누르면서 찾기.(아래로 내려감)
  - `ctrl + s` 는 초기상태에서는 다른 조작이 할당되어 있다. 그 설정을 변경해서 bash에서 `ctrl + s` 명령어를 사용할 수 있게 한 것
  - 다른 서버에서도 전방 검색을 하려면 그 서버에서도 위와 같은 설정이 필요하다.



- 파일 끝으로 이동
```
shift + g
```

- 파이프라인(|)
  - 어떤 명령어 실행 결과 출력을 그대로 다른 명령어에 넘김. 즉 앞의 출력이 뒤의 입력이 됨
  - 받는 쪽 명령어는 열어야 할 파일 지정을 생략한다. 
  - 여러 번 사용 가능
  - 콘솔애플리케이션에서 사용가능한 것이지 GUI애플리케이션 다수에서는 사용 못함
```
grep "/retro" access.log.1 | less
```
```
(중간의 grep -v "/live" 는 앞의 출력결과에서 지정한 문자열(/live) 을 포함하지 않는 줄만 출력)
grep "/retro" access.log.1 | grep -v "/live" | less
```


- `top` 시스템 상태 전반적으로 확인(cp, memory, process)
  - `shift + m` 메모리사용률 내림차순으로, `shift + t` CPU시간 순서, `shift + p` CPU 사용량 순서.
  - (shift + m 누른 후) `c` 상세표시 전환

```
top
shift + m
c
q(top 모드 종료, quit 의미)
```

- 실행중인 프로세스 종료 
```
kill PID
```
```
다른 사용자의 프로세스라면 sudo 붙여야됨
sudo kill PID
```
```
여러 프로세스 ID를 동시에 띄워서 나열하면 동시에 종료 가능
sudo kill 111 222 333 444 ...C
```

- 디렉토리 삭제
  - rm는 파일은 삭제할 수 있지만 디렉토리는 삭제하지 못한다. 디렉토리와 그 내용물을 모두 삭제하려면 rm -r 으로 하면 된다. 이 때 정말 삭제하시겠습니까 ? 라는 문구가 각 파일 하나씩 다 나온다
  - 삭제 질문이 뜨지 않게 하려면 rm -rf으로. rm -rf는 확인절차 없이 삭제하므로 극도로 조심해서 사용해야 한다. 리눅스에서는 삭제된 파일이나 디렉토를 절대 복구 못한다.
  - cf) rm 이라고 치면 도움말을 확인할 수 있다.

```
rm -r 디렉토리_이름
rmdir -r 디렉토리_이름

rm -rf 디렉토리_이름
rmdir -rf 디렉토리_이름
```

- 우분투 패키지 관리툴 업데이트

```
sudo apt-get update
```

- grep
  - `-r`은 서브 폴더까지 검색하도록 지정. 재귀적으로 찾는 것임
  - `-i`는 ignore case, 즉 알파벳 대문자, 소문자 차이 무시하고 검색
  - grep -r -i "검색하고 싶은 문자열" 찾을 파일이 있는 폴더 경로(검색 시작점) 및 파일
  - `-E` 정규 표현식을 사용할 때 앞에 붙임.
  - 정규 표현식들
    - `()` 그룹화
    - `|` 좌우 중 하나
    - `?` 직전 표현이 0회 또는 1회 등장
    - `*` 직전 표현이 0회 이상 연속해서 등장
    - `+` 직전 표현이 1회 이상 연속해서 등장
    - `.` 임의의 한 문자
    - `^` 줄 머리
    - `$` 줄 끝
  - 압축 파일은 grep으로 직접 쓸 수 없다. zcat 등의 로그 파일 압축 형식에 맞는 명령어로 열어야 한다.

```
(/home/docs/ 밑에 있는 모든 파일안에서 대소문자 무관하게 "api" 단어를 가진 파일과 그 문자열을 다 찾아낸다)
grep -r -i "api" /home/docs/
```

```
grpe -r -i -E "((야메로) *(타로)|yamero +tarou)" /home/docs/
```

```
(아래처럼 -r옵션이 없으면 파일 안에서 지정한 내용을 포함한 줄을 찾을 수 있다.)
grep "orange" /var/log/apache2/access.log
```

- 로그 파일 압축 출력
  - 오래된 로그 파일은 디슼 용량을 아끼기 위해 압축한다. 그 압축파일들을 grep으로 직접 사용할 수 없다.
  - `cat` 비압축 테스트 파일용. 지정한 파일 내용을 읽어서 그대로 출력
  - `zcat` gzip형식 전용 .gz .tgz 가능
  - `xcat` xz형식 전용 .xz 가능
  - `unzip` zip형식 전용


- `지금 이 순간` 실시간 로그 확인
  - tail은 파일 내용 끝부분만 출력
  - `-F` 옵션은 파일 변경을 감시해서 내용이 추가될 때마다 그 부분을 실시간으로 출력
```
tail -F access.log
```




## vim

[cheat-sheet](https://vim.rtorr.com/lang/ko)

- 실행

```
vim 파일이름
```

또는 `vim 파일 경로`

```
vim /etc/경로~
```

만약 시스템 설정 파일을 변경하려면 `sudo` 붙이기

```
sudo vim /etc/경로~
```

- 실행 안되면 아래 2개 중 하나로 설치

```
sudo apt-get install vim
yum install vim
```

- 홈(노멀모드)에서 텍스트 `편집모드`는 `i`(insert), 편집 끝내기(돌아가기는 다 esc)는 `esc`
- 홈(노멀모드)에서 `검색모드`는 `/`
  - 검색하고 싶은 문자열 입력 후 `엔터`
  - `N`은 찾은 문자열 이후에 다음 같은 문자열, 순서대로 찾을 수 있음. 반대 방향은 `SHIFT + N`
  - 정규표현식 가능. / 뒤에 `\v` (백슬러시와 소문자v)
    - ex) CP949 또는 EUC-KR을 한번에 검색
    ```
    /\v(CP949|EUC-KR)
    ```
- 저장 및 나가기
  - 홈(노멀모드)에서 나가기`esc` 한 다음에 `:wq`
    - w : write
    - q : quit

- 복사 & 붙여넣기
  - 노멀모드에서 복사하고 싶은 위치까지 이동 후 `v` 하면 visual 모드로 변환. 커서 움직여서 복사할 범위 설정
  - 복사하기 `v`,  cf) 양크는 vim에 있는 클립보드임. 양크(yank : 끌어당기다) 의 y
  - 붙여넣기 `shift + p`, paste의미인 p
    - 붙여넣을 횟수 지정해서도 가능. `횟수 + shift + p`, ex) 10 shift + p

- 일시정지 및 다시 돌아가기
  - 작업 중 `ctrl + z`
  - 지금 실행중인 애플리케이션 일시 정지. gui 애플리케이션 창을 뒤로 감춘 거랑 비슷
  - 다시 돌아가기. `fg` (ForeGround) 의 fg. 

- 작업한 것 되돌리기와 다시 되살리기
  - 되돌리기 - 노멀모드에서 `u`, 연속해서 u는 여러번 되돌리기 가능
  - 되돌리기의 되살리기는 `ctrl + r`
  - 저장하고 나서 다시 열었을 때는 이전의 작업들은 먹히지 않음. ex) 한글 파일 작업할 때 같음
  - 둘 다 횟수 지정 가능. 
    - `10u`, 그리고 `9999u`은 첫 상태로 되돌아가는 것
    - `10 ctrl + r`
  
## 가상단말(tmux)
- 접속이 끊기기 쉬운 WiFi나 테더링 경유로 SSH 접속할 때 좋음
- 서버에서 tmux로 여러 화면을 사용한다면 SSH 접속은 처음 한번만 하면 됨. 인증도 한 번만 하면 되고 재접속도 한 번으로 끝. tmux attach 로 접속이 끊기기 전 상태로 바로 복귀도 가능
- 접속
```
tmux
```
- 명령어 찾지 못했다고 나오면 
```
sudo apt-get install tmux
```

- 접속이 끊겼을 시
```
tmux attach
```

- tmux 기능은 먼저 `ctrl + B` 를 먼저 입력 후 아래 명령어 입력. 이런 키를 prefix key
  - `D` detach
  - `C` create
  - `P` previous
  - `N` Next
  - `R` 되살리기
  - `C` 프로세스 종료
  - `Z` 프로세스 일시 정지

- 여러 창 옮겨다니기
  - 새로운 창을 `ctrl + B` + `C` 로 만든 후
  - `ctrl + B` + `N` 또는 `P`

- 화면 분할
  - 가로 분할
  ```
  ctrl + B 후 "
  ```
  - 세로 분할
  ```
  ctrl + B 후 %
  ```
  - 분할된 화면에서 화면 전환.
  ```
  ctrl + B 후 ↑↓ 또는 → ←
  ```
  - 스크롤 하기. 화면을 벗어난 내용확인이 끝났으면 `Q`키로 원래 상태로 돌아오면 된다. 
  ```
  ctrl + B 후 [ 누르면 커서를 화살표나 마우스 휠로 스크롤 가능
  ```
  - 화면 분할 종료
  ```
  exit
  ```
  - 분할된 화면 크기 변경하기
  ```
  ctrl + B 후 ctrl를 누르면서 ↑↓ → ←
  ```
  
  